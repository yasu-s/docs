# DevSumi 2020

## 概要

* 日時：2020/2/13, 2/14
* URL：https://event.shoeisha.jp/devsumi/20200213

## 14-D-6　メルペイリリースとその後一年間の裏側と学び

### 概要

* 2020/02/14 15:15 ～ 16:00
* 木村 秀夫氏 メルペイ
* https://event.shoeisha.jp/devsumi/20200213/session/2495/

### アーキテクチャ

* マイクロサービスアーキテクチャ
  * 50以上
* 1544億円を取り扱う
* 600万人以上

----

* クラウドネイティブ
  * k8s
  * GCP
  * Cloud Spanner
  * Cloud SQL
* Tools
  + GitHub
  * Slack

* Backend
  * Go
  * gRPC
* Android
  * Kotlin/RxJava/Redux
* iOS
  * Swift
  * MVVM
* Frontend
  * Vus.js/Nuxt
  * TypeScript

### 組織

* PM-EM組織

### リリース

* 2019/1-3
  * 最初のリリース
  * リリースまで14ヶ月かかった
  * 最初は2018/8リリース予定
  * 6ヶ月の遅延
    * 不確実性
      * 肥大化する要件
        * フェーズの整理（spec freeze, code freeze）
      * 複雑な依存関係
        * ステークホルダーが多い
        * スコープの整理（段階的リリース）
    * 見積もりが意味がなかった
  * 大きな初期リリースにはウォータフォール的なプロジェクトマネジメント（やりすぎはだめ）
* 2019/4-6
  * 後払い機能・キャンペーン機能のリリース
  * メルカリ本体から人を借りて対応
  * メルカリ本体のマイクロサービス化の延期
    * 技術的負債
  * 開発中のプロジェクトのフリーズ
    * 組織的負債
  * リソース集中は必要だが、やりすぎはだめ
* 2019/7-9
  * 技術的負債の返済
  * 小さく借りて小さく返すのが理想
  * 借りすぎ＝悪
  * プロダクトアウト VS 将来の開発スピード
  * 一時的に大きく借りたので一定返す期間が必要
  * 課題の洗い出し・優先順位の整理
    * セキュリティリスクの高いもの
    * 部署横断で意思決定が必要なもの
  * OKR
    * エンジニア以外の人にも技術的負債の理解が進んだ
* 2019/10-12
  * インシデントレスポンスの改善
  * 安心安全なサービスを実現
    * 正しい状態：SLO。QRコード決済リクエスト99%が100ms以内に処理
    * 正しい状態でないことに気づく：障害監視・対応
    * 同じ問題がおきない：インシデントの振り返り
      * Slack報告、起票、JIRAチケットトラッキング
* 2020/1-
  * プロダクティビティの向上
  * 今の体制でできることをn倍にしたい
  * what
    * 運用生産性
    * 開発生産性
  * how
    * 省力化
    * 可視化
    * 汎化
  * OKR

### まとめ

* 全て前者のOKRに組み込んだ
* 採用もOKRに組み込む

## 14-A-7 TOYOTA x Serverless x Microservices 〜 グローバル展開のコネクティッドカーを支えるアーキテクチャとエンジニアリングチーム

### 概要

* 2020/02/14 16:20 ～ 17:05
* 浦山 雄也氏　トヨタ自動車, 松本 崇之氏 トヨタコネクティッド, 内海 英一郎氏 アマゾン ウェブ サービス ジャパン
* https://event.shoeisha.jp/devsumi/20200213/session/2389/

### なぜServerlessを選んだか

* コネクティッドサービス
  * 車載デバイスとパートナーと連携
  * 車のヘルスチェック
  * 盗難検知, 検知、エンジンを動かさなくするなど
* 圧倒的スピードでお客様へ実現
  * 人的・コストリソースのマスト -> リソースは無限でない -> 価値を生まないムダを削除
* 変化するアクセス
  * オンプレでは最大スペックで対処
  * サーバーレスでプロジショニング
* 長いライフサイクルへの対応
  * 維持・保守のムダ
  * すべてマネージド
* より広い地域で提供
  * シェアに合わせてリソース確保

### アーキテクチャ

* Global：コア機能の開発を加速
* Regional：お客様のニーズ
* Mobility Gateway
  * feature: 250
  * リアルタイム処理
* 設計指針
  * 一貫して分離
  * 自律・緩やかに統合
  * ステートレス

### アーキテクチャスタイル

* N層
  * Gateway
  * Logic
  * Data
  * Data以外はステートレス
* Webキューワーカー、イベントドリブン
  * ウェブプロセスとワーカープロセスに分離
  * インテグレーションコンポーネント配置
* マイクロサービス
  * 最小単位でコンポーネント群を分割

* リアクティブスケーリング型
  * API Gateway
  * Lambda
* プロアクティブスケーリング型
  * ALB 
  * Fargate
  * 要求に大してできるだけ早く・安定した応答を返す
* DB
  * DynamoDB
    * オンデマンド：リアクティブスケーリング型
    * プロビジョン：プロアクティブスケーリング型
* P2Pメッセージング
  * SQS
* ファンアウトメッセージング
  * SNS
* イベントストリーミング
  * Kinesis
* ワーカープロセス
  * Lambda

### チーム

* 責務にあわせてチームを切る
  * 車載は数年単位、地域は数ヶ月単位の開発のため
* サービスごとのチームに最後は元に戻す
* 開発〜運用までを行う
  * 車載デバイス知識以外は当時スキルがなかった
  * アジャイルの知識：アジャイルコーチを招致
  * アーキテクチャが正しいのかわからない：AWSにきいた
  * 勉強会を実施・ペアプロ・モブプロ
  * 運用の自動化などに着手

### まとめ

* 開発からムダが削減
* 新機能追加、リファクタリングなどに投資できるようになった
